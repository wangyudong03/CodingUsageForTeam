<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <%- include('partials/head', { pageTitle: 'Coding Usage' }) %>
  <style>
    /* Plaza 页面特有样式 - 已移动到 common.css */
  </style>
</head>

<body>
  <div class="container">
    <%- include('partials/nav', { showPlazaLink: true }) %>

    <!-- 排序控制栏 -->
    <div class="sort-bar">
      <div class="sort-info">
        <svg class="octicon" viewBox="0 0 16 16" width="16" height="16"
          style="margin-right: 6px; vertical-align: -3px;">
          <path
            d="M0 1.75A.75.75 0 01.75 1h10.5a.75.75 0 010 1.5H.75A.75.75 0 010 1.75zm0 6A.75.75 0 01.75 7h7.5a.75.75 0 010 1.5H.75A.75.75 0 010 7.75zm0 6A.75.75 0 01.75 13h4.5a.75.75 0 010 1.5H.75a.75.75 0 01-.75-.75z">
          </path>
        </svg>
        <strong><%= cards.length %></strong> subscriptions
      </div>
      <div class="sort-dropdown">
        <div class="dropdown-overlay" id="dropdownOverlay"></div>
        <button type="button" class="sort-trigger" id="sortTrigger">
          Sort
          <svg viewBox="0 0 16 16" width="12" height="12" fill="currentColor" style="margin-left: 4px;">
            <path
              d="M4.427 9.573l3.396 3.396a.25.25 0 00.354 0l3.396-3.396A.25.25 0 0011.396 9H4.604a.25.25 0 00-.177.427z">
            </path>
          </svg>
        </button>
        <div class="dropdown-menu" id="sortMenu">
          <div class="dropdown-header">Sort by</div>
          <button type="button" class="dropdown-item <%= sortBy === 'activity' ? 'selected' : '' %>"
            data-sort="activity">
            <svg viewBox="0 0 16 16" fill="currentColor" class="check-icon">
              <path
                d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z">
              </path>
            </svg>
            Activity Time
          </button>
          <button type="button" class="dropdown-item <%= sortBy === 'usage' ? 'selected' : '' %>" data-sort="usage">
            <svg viewBox="0 0 16 16" fill="currentColor" class="check-icon">
              <path
                d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z">
              </path>
            </svg>
            Usage Amount
          </button>
          <div class="dropdown-divider"></div>
          <div class="dropdown-header">Order</div>
          <button type="button" class="dropdown-item <%= order === 'desc' ? 'selected' : '' %>" data-order="desc">
            <svg viewBox="0 0 16 16" fill="currentColor" class="check-icon">
              <path
                d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z">
              </path>
            </svg>
            Descending
          </button>
          <button type="button" class="dropdown-item <%= order === 'asc' ? 'selected' : '' %>" data-order="asc">
            <svg viewBox="0 0 16 16" fill="currentColor" class="check-icon">
              <path
                d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z">
              </path>
            </svg>
            Ascending
          </button>
        </div>
      </div>
    </div>

    <% if (cards.length === 0) { %>
      <div class="panel">
        <%- include('partials/empty-state', {
          emptyTitle: 'No Public Subscriptions Yet',
          emptyDesc: 'No public subscriptions available at the moment. Users can enable public visibility in their settings.'
        }) %>
      </div>
    <% } else { %>
      <div class="grid">
        <% cards.forEach(card => { %>
          <%- include('partials/usage-card', { card: card }) %>
        <% }) %>
      </div>
    <% } %>
  </div>

  <%- include('partials/bind-modal') %>

  <script>
    // 设置全局 BASE_PATH 变量供 JS 模块使用
    window.BASE_PATH = '<%= basePath %>';
  </script>
  <script src="<%= basePath %>/static/api-manager.js"></script>
  <script src="<%= basePath %>/static/bind-modal.js"></script>
  <script src="<%= basePath %>/static/plaza.js"></script>
</body>

</html>
